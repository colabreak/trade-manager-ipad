<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>オプチャ管理</title>
<style>
  :root{
    --bg: #f6f7f9;
    --card: #ffffff;
    --ink: #111827;
    --muted:#6b7280;
    --line:#e5e7eb;
    --brand:#2563eb;
    --danger:#ef4444;
  }
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font:13px/1.35 -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,'Hiragino Kaku Gothic ProN','Meiryo',sans-serif}

  .container{max-width:640px;margin:12px auto;padding:0 12px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:14px;box-shadow:0 2px 8px rgba(0,0,0,.04)}

  .header{padding:12px 12px 0}
  h1{margin:0 0 8px;text-align:center;font-size:15px;font-weight:700}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;padding:0 0 12px}
  .input{height:30px;border-radius:8px;border:1px solid var(--line);padding:0 10px;font-size:13px;background:#fff}
  .btn{height:30px;padding:0 12px;border-radius:8px;border:1px solid transparent;font-size:13px;cursor:pointer}
  .btn.primary{background:var(--brand);color:#fff}
  .btn.secondary{background:#fff;border-color:var(--line)}
  .btn.danger{background:#fff;border-color:#fecaca;color:#b91c1c}

  .tableWrap{padding:8px 12px 12px}
  table{width:100%;border-collapse:collapse;table-layout:fixed}
  th,td{border:1px solid var(--line);padding:6px 8px}
  th{background:#f9fafb;color:#374151;font-weight:600}

  /* columns */
  .col-date{width:18ch}
  .col-link{width:5ch;text-align:center}
  .col-del{width:7ch;text-align:center}

  input[type="date"], input[type="text"]{height:28px;border-radius:8px;border:1px solid var(--line);padding:0 8px;font-size:13px;background:#fff}
  input[type="date"]{width:14ch;text-align:center}
  .name{width:100%}
  .link{width:3ch;text-align:center}
  .stack{display:flex;align-items:center;gap:6px}
  .cooldown{color:#b91c1c;font-weight:700}
  .clear{color:var(--ink)}
</style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="header">
        <h1>オプチャ管理</h1>
        <div class="toolbar">
          <input id="search" class="input" type="search" placeholder="検索（名前・リンク部分一致）" />
          <button id="add" class="btn primary">1行追加</button>
          <button id="save" class="btn secondary">保存</button>
        </div>
      </div>
      <div class="tableWrap">
        <table>
          <thead>
            <tr>
              <th class="col-date">最終日付 / 更新</th>
              <th>名前</th>
              <th class="col-link">リンク1</th>
              <th class="col-link">リンク2</th>
              <th class="col-del">削除</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>
  </div>

<script>
const STORAGE_KEY = 'opchatManagerV3';
let rows = [];
let filterText = '';

const todayStr=()=>{const d=new Date(),z=n=>String(n).padStart(2,'0');return `${d.getFullYear()}-${z(d.getMonth()+1)}-${z(d.getDate())}`}
const daysSince=(iso)=>{if(!iso)return 9999;const t=new Date(iso);if(isNaN(t))return 9999;return Math.floor((Date.now()-t.getTime())/86400000)}

function load(){try{rows=JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]')}catch{rows=[]}}
function save(){localStorage.setItem(STORAGE_KEY,JSON.stringify(rows))}
function addRow(){rows.push({date:todayStr(),name:'',link1:'',link2:''});render()}
function confirmDel(i){if(confirm('この行を削除しますか？')){rows.splice(i,1);render()}}
function matchesFilter(r){if(!filterText)return true;const t=filterText.toLowerCase();return (r.name||'').toLowerCase().includes(t)||(r.link1||'').toLowerCase().includes(t)||(r.link2||'').toLowerCase().includes(t)}

function render(){
  const tb=document.getElementById('tbody');tb.innerHTML='';
  rows.forEach((r,i)=>{
    if(!matchesFilter(r)) return;
    const tr=document.createElement('tr');

    // date + update
    const tdDate=document.createElement('td');
    const stk=document.createElement('div');stk.className='stack';
    const inputDate=document.createElement('input');inputDate.type='date';inputDate.value=r.date||'';inputDate.className=daysSince(r.date)<15?'cooldown':'clear';
    inputDate.oninput=e=>{r.date=e.target.value;inputDate.className=daysSince(r.date)<15?'cooldown':'clear'};
    const upd=document.createElement('button');upd.className='btn secondary';upd.textContent='更新';upd.onclick=()=>{r.date=todayStr();inputDate.value=r.date;inputDate.className='cooldown'};
    stk.append(inputDate,upd);tdDate.appendChild(stk);

    // name
    const tdName=document.createElement('td');
    const nm=document.createElement('input');nm.type='text';nm.className='name';nm.value=r.name||'';nm.oninput=e=>r.name=e.target.value;tdName.appendChild(nm);

    // link1
    const tdL1=document.createElement('td');
    const l1=document.createElement('input');l1.className='link';l1.inputMode='numeric';l1.maxLength=2;l1.value=r.link1||'';l1.oninput=e=>{e.target.value=e.target.value.replace(/[^0-9]/g,'').slice(0,2);r.link1=e.target.value};tdL1.appendChild(l1);

    // link2
    const tdL2=document.createElement('td');
    const l2=document.createElement('input');l2.className='link';l2.inputMode='numeric';l2.maxLength=2;l2.value=r.link2||'';l2.oninput=e=>{e.target.value=e.target.value.replace(/[^0-9]/g,'').slice(0,2);r.link2=e.target.value};tdL2.appendChild(l2);

    // delete
    const tdDel=document.createElement('td');
    const del=document.createElement('button');del.className='btn danger';del.textContent='削除';del.onclick=()=>confirmDel(i);tdDel.appendChild(del);

    tr.append(tdDate,tdName,tdL1,tdL2,tdDel);tb.appendChild(tr);
  })
}

window.addEventListener('DOMContentLoaded',()=>{
  load();render();
  document.getElementById('add').onclick=addRow;
  document.getElementById('save').onclick=()=>{save();alert('保存しました')};
  document.getElementById('search').addEventListener('input',e=>{filterText=e.target.value.trim();render()});
})
</script>
</body>
</html>

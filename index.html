<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>オプチャ管理</title>
<style>
  :root{
    --bg: #f3f5f9;
    --card: #ffffff;
    --ink: #0f172a;
    --muted:#6b7280;
    --line:#e5e7eb;
    --brand:#2563eb;
    --brand-weak:#ebf2ff;
    --danger:#ef4444;
    --danger-weak:#ffecec;
  }
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font:13px/1.35 -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,'Hiragino Kaku Gothic ProN','Meiryo',sans-serif}
  .container{max-width:760px;margin:16px auto;padding:0 12px}
  .card{background:var(--card);border-radius:18px;box-shadow:0 8px 24px rgba(15,23,42,.06);overflow:hidden}
  .header{padding:14px 16px;background:linear-gradient(180deg,#ffffff,#fafbff)}
  .header h1{margin:0;text-align:center;font-size:16px;font-weight:700;letter-spacing:.02em}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin:8px 0 4px 0}
  .input, .btn{height:32px;border-radius:10px;border:1px solid var(--line);font-size:13px}
  .input{padding:0 10px;background:#fff}
  .btn{padding:0 12px;background:var(--brand);color:#fff;border:0;box-shadow:0 1px 0 rgba(0,0,0,.04)}
  .btn.secondary{background:#fff;color:var(--ink);border:1px solid var(--line)}
  .btn.danger{background:var(--danger)}

  .tableWrap{padding:8px 12px 16px}
  table{width:100%;border-collapse:separate;border-spacing:0 8px;table-layout:fixed}
  thead th{color:var(--muted);font-weight:700;font-size:12px;padding:0 8px;text-align:center}
  tbody tr{background:#fff;border-radius:12px;box-shadow:0 1px 0 rgba(0,0,0,.02)}
  tbody td{padding:8px 8px;vertical-align:middle}
  tbody tr td:first-child{border-top-left-radius:12px;border-bottom-left-radius:12px}
  tbody tr td:last-child{border-top-right-radius:12px;border-bottom-right-radius:12px}
  .stack{display:flex;align-items:center;gap:8px;justify-content:center}
  input[type="date"], input[type="text"], input[type="search"]{height:30px;border-radius:10px;border:1px solid var(--line);padding:0 10px;font-size:13px;background:#fff}
  input[type="date"]{width:15ch;text-align:center}
  .name{width:100%}
  .link{width:4ch;text-align:center}
  .update{background:var(--brand-weak);color:var(--brand);border:1px solid #c7d7ff}
  .del{background:var(--danger-weak);color:var(--danger);border:1px solid #ffc9c9}
  .cooldown{color:var(--danger);font-weight:700}
  .clear{color:var(--ink)}
</style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="header">
        <h1>オプチャ管理</h1>
        <div class="toolbar">
          <input id="search" class="input" type="search" placeholder="検索（名前・リンク部分一致）" />
          <button id="add" class="btn">1行追加</button>
          <button id="save" class="btn">保存</button>
        </div>
      </div>
      <div class="tableWrap">
        <table>
          <thead>
            <tr>
              <th>最終日付 / 更新</th>
              <th>名前</th>
              <th>リンク1</th>
              <th>リンク2</th>
              <th>削除</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>
  </div>

<script>
const STORAGE_KEY = 'opchatManagerV3';
let rows = [];
let filterText = '';

function todayStr(){
  const d = new Date();
  const z=(n)=>String(n).padStart(2,'0');
  return `${d.getFullYear()}-${z(d.getMonth()+1)}-${z(d.getDate())}`;
}
function daysSince(iso){
  if(!iso) return 9999; const t = new Date(iso); if(isNaN(t)) return 9999; return Math.floor((Date.now()-t.getTime())/86400000);
}
function load(){ try{ rows = JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]'); }catch{ rows=[]; } }
function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(rows)); }
function addRow(){ rows.push({date: todayStr(), name:'', link1:'', link2:''}); render(); }
function confirmDel(i){ if(confirm('この行を削除しますか？')){ rows.splice(i,1); render(); } }
function matchesFilter(r){ if(!filterText) return true; const t = filterText.toLowerCase(); return (r.name||'').toLowerCase().includes(t) || (r.link1||'').toLowerCase().includes(t) || (r.link2||'').toLowerCase().includes(t); }

function render(){
  const tb = document.getElementById('tbody'); tb.innerHTML='';
  rows.forEach((r,i)=>{
    if(!matchesFilter(r)) return;
    const tr = document.createElement('tr');

    // 日付 + 更新（横並び）
    const tdDate = document.createElement('td');
    const wrap = document.createElement('div'); wrap.className='stack';
    const inputDate = document.createElement('input'); inputDate.type='date'; inputDate.value=r.date||'';
    const d = daysSince(r.date); inputDate.className = d<15? 'cooldown' : 'clear';
    inputDate.oninput = (e)=>{ r.date=e.target.value; inputDate.className = daysSince(r.date)<15? 'cooldown':'clear'; };
    const btnUpd = document.createElement('button'); btnUpd.className='btn update'; btnUpd.textContent='更新'; btnUpd.style.height='30px'; btnUpd.onclick=()=>{ r.date=todayStr(); inputDate.value=r.date; inputDate.className='cooldown'; };
    wrap.append(inputDate, btnUpd); tdDate.appendChild(wrap);

    // 名前
    const tdName=document.createElement('td'); const inputName=document.createElement('input'); inputName.type='text'; inputName.className='name'; inputName.value=r.name||''; inputName.oninput=(e)=>r.name=e.target.value; tdName.appendChild(inputName);

    // リンク1
    const tdL1=document.createElement('td'); const inputL1=document.createElement('input'); inputL1.className='link'; inputL1.inputMode='numeric'; inputL1.maxLength=2; inputL1.value=r.link1||''; inputL1.oninput=(e)=>{ e.target.value=e.target.value.replace(/[^0-9]/g,'').slice(0,2); r.link1=e.target.value; }; tdL1.appendChild(inputL1);

    // リンク2
    const tdL2=document.createElement('td'); const inputL2=document.createElement('input'); inputL2.className='link'; inputL2.inputMode='numeric'; inputL2.maxLength=2; inputL2.value=r.link2||''; inputL2.oninput=(e)=>{ e.target.value=e.target.value.replace(/[^0-9]/g,'').slice(0,2); r.link2=e.target.value; }; tdL2.appendChild(inputL2);

    // 削除
    const tdDel=document.createElement('td'); const btnDel=document.createElement('button'); btnDel.className='btn del'; btnDel.textContent='削除'; btnDel.style.height='30px'; btnDel.onclick=()=>confirmDel(i); tdDel.appendChild(btnDel);

    tr.append(tdDate, tdName, tdL1, tdL2, tdDel); tb.appendChild(tr);
  });
}

window.addEventListener('DOMContentLoaded',()=>{
  load(); render();
  document.getElementById('add').onclick=()=>addRow();
  document.getElementById('save').onclick=()=>{ save(); alert('保存しました'); };
  document.getElementById('search').addEventListener('input',e=>{ filterText=e.target.value.trim(); render(); });
});
</script>
</body>
</html>
